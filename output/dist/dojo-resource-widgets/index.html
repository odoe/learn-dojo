<!DOCTYPE html>
<html lang="en-us">
	<head>
		<base href="/">
		<script type="text/javascript" src="https://www.google-analytics.com/analytics.js"></script>
		<script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-56544808-7"></script>
		<script>
			window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());

			gtag('config', 'UA-56544808-7');
		</script>
		<meta name="apple-mobile-web-app-title" content="learn-dojo">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="default">
		<meta name="theme-color" content="#009dff">
		<link rel="apple-touch-icon" sizes="512x512" href="icon_512x512.ca45ef50142a78ad4bd2d28215f15034.png">
		<link rel="apple-touch-icon" sizes="256x256" href="icon_256x256.7da342a93e078e9a7fef21fa5d9dbbaf.png">
		<link rel="apple-touch-icon" sizes="128x128" href="icon_128x128.811bfb9a7c545c93ad37790968688f24.png">
		<link rel="manifest" href="manifest.83b2d52a04a4315afec956b410eaacf0.json">
		<script>
	if (!window['learn_dojo']) {
		window['learn_dojo'] = {}
	}
	window['learn_dojo'].base = '/'</script>
		<script>
		if ('serviceWorker' in window.navigator) {
			window.addEventListener('load', function() {
				window.navigator.serviceWorker.register('service-worker.js');
			});
		}
	</script>
		<meta name="mobile-web-app-capable" content="yes">
		
		<meta charset="utf-8">
		<meta name="theme-color" content="#009dff">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="icon" href="/assets/favicon.ico">
		<link rel="stylesheet" type="text/css" href="./assets/prism.css">
		<link rel="preconnect" href="https://www.google-analytics.com">
		<title>Data Aware Widgets in Dojo</title>
		<meta name="description" content="Dojo resource widgets allow you to make widgets data aware and share a single source of data!">
	<style>.Blog-m__root__5737d01B0aR{padding:1.2rem}@import url(https://fonts.googleapis.com/css?family=Montserrat&display=swap);html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{-webkit-box-sizing:content-box;box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{-webkit-box-sizing:border-box;box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{-webkit-box-sizing:border-box;box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.6666666666666667 Georgia,Cambria,serif;-webkit-box-sizing:border-box;box-sizing:border-box;overflow-y:scroll}*{-webkit-box-sizing:inherit;box-sizing:inherit}:before{-webkit-box-sizing:inherit;box-sizing:inherit}:after{-webkit-box-sizing:inherit;box-sizing:inherit}body{color:rgba(0,0,0,.87);font-family:Georgia,Cambria,serif;font-weight:400;word-wrap:break-word;-webkit-font-kerning:normal;font-kerning:normal;-ms-font-feature-settings:"kern","liga","clig","calt";-webkit-font-feature-settings:"kern","liga","clig","calt";font-feature-settings:"kern","liga","clig","calt","kern"}img{max-width:100%;padding:0;margin:0 0 1.66667rem}h1{font-size:2rem}h1,h2{padding:0;margin:0 0 1.66667rem;color:rgba(0,0,0,.5);font-family:Montserrat,sans-serif;font-weight:400;text-rendering:optimizeLegibility;line-height:1.1}h2{font-size:1.51572rem}h3{font-size:1.31951rem}h3,h4{padding:0;margin:0 0 1.66667rem;color:rgba(0,0,0,.5);font-family:Montserrat,sans-serif;font-weight:400;text-rendering:optimizeLegibility;line-height:1.1}h4{font-size:1rem}h5{font-size:.87055rem}h5,h6{padding:0;margin:0 0 1.66667rem;color:rgba(0,0,0,.5);font-family:Montserrat,sans-serif;font-weight:400;text-rendering:optimizeLegibility;line-height:1.1}h6{font-size:.81225rem;font-style:italic}hgroup{padding:0;margin:0 0 1.66667rem}ul{list-style-position:outside;list-style-image:none;list-style:disc}ol,ul{padding:0;margin:0 0 1.66667rem 1.66667rem}ol{list-style-position:outside;list-style-image:none}dd,dl,figure,p{padding:0;margin:0 0 1.66667rem}pre{font-size:.85rem}pre,table{padding:0;margin:0 0 1.66667rem;line-height:1.66667rem}table{font-size:1rem;border-collapse:collapse;width:100%}fieldset{padding:0}blockquote,fieldset{margin:0 0 1.66667rem}blockquote{padding:.83333rem .83333rem .83333rem 1.45833rem;font-size:1.1487rem;line-height:1.66667rem;background:rgba(0,0,0,.03);color:rgba(0,0,0,.69);border-left:.20833rem solid rgba(0,0,0,.2)}form,iframe,noscript{padding:0;margin:0 0 1.66667rem}hr{padding:0;margin:0 0 calc(1.66667rem - 1px);background:rgba(0,0,0,.2);border:none;height:1px}address{padding:0;margin:0 0 1.66667rem}b,dt,strong,th{font-weight:700}li{margin-bottom:calc(1.66667rem / 2)}ol li,ul li{padding-left:0}li>ol{margin-left:1.66667rem;margin-bottom:calc(1.66667rem / 2);margin-top:calc(1.66667rem / 2)}li>ul{margin-left:1.66667rem;margin-bottom:calc(1.66667rem / 2);margin-top:calc(1.66667rem / 2)}blockquote :last-child{margin-bottom:0}li :last-child{margin-bottom:0}p :last-child{margin-bottom:0}li>p{margin-bottom:calc(1.66667rem / 2)}code,kbd,samp{font-size:.85rem;line-height:1.66667rem}abbr,acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}abbr[title]{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help;text-decoration:none}td,th,thead{text-align:left}td,th{border-bottom:1px solid rgba(0,0,0,.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding:.83333rem 1.11111rem calc(.83333rem - 1px)}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}a{color:#07e;text-decoration:none}a:active,a:hover{color:#e32}blockquote>:last-child{margin-bottom:0}blockquote cite{font-size:1rem;line-height:1.66667rem;color:rgba(0,0,0,.87);font-weight:400}blockquote cite:before{content:"\2014   "}@media only screen and (max-width:480px){ol,ul{margin-left:1.66667rem}blockquote{margin-left:-1.25rem;margin-right:-1.25rem;padding-left:1.14583rem;padding-right:1.25rem}}h1,h2,h3,h4,h5,h6{margin-top:3.33333rem}body{margin:0;padding:0;color:rgba(46,46,46,.95)}header{font-family:Montserrat,sans-serif;font-weight:400;text-rendering:optimizeLegibility;line-height:1.1}article img{display:block;max-width:500px;margin:0 auto}code[class*=language-],pre[class*=language-]{font-size:14px}@media only screen and (max-width:480px){article img{display:block;max-width:300px;margin:0 auto}}.Footer-m__root__5737d01zPMX{-webkit-box-flex:1;-ms-flex:1;flex:1;text-align:center;padding:3rem 1rem;overflow:hidden}.Footer-m__details__5737d02pZwP{font-size:.75rem}.Footer-m__logo__5737d02kD38{max-height:48px}.Footer-m__link__5737d03-JoA,.Footer-m__link__5737d03-JoA:visited{color:#003866}.Header-m__root__5737d015XcQ{-webkit-box-flex:1;-ms-flex:1;flex:1;overflow:hidden;color:#fff;background-color:#333;padding:1rem}.Header-m__title__5737d03OSiY{font-size:20px;margin:0;font-weight:400}.Header-m__link__5737d02GEKH:hover{color:#fff;background-color:#333}.Header-m__link__5737d02GEKH{min-width:140px;text-align:center;text-decoration:none;padding:18px;color:#fff;-webkit-box-sizing:border-box;box-sizing:border-box}:root{--grid-base:8px}.Hero-m__root__5737d012HF4{width:100vw;height:300px;max-height:300px;display:-webkit-box;display:-ms-flexbox;display:flex;overflow:hidden;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:relative;left:50%;right:50%;margin:0 -50vw 2rem}.Hero-m__image__5737d02nrHx{width:100vw;height:300px;-o-object-fit:cover;object-fit:cover}.Hero-m__description__5737d03I4v5{margin-left:calc(5 * 8px);margin-left:calc(5 * var(--grid-base));margin-top:calc(8px);margin-top:calc(var(--grid-base));position:absolute;font-size:.8rem;top:0;color:#fff}.SignUp-m__root__5737d01pvR6{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center}.SignUp-m__title__5737d02WSYN{margin-top:0}.SignUp-m__email__5737d020Zk1{margin:90px 0 40px;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif,BlinkMacSystemFont,Oxygen,Fira Sans,Droid Sans,Helvetica Neue}.SignUp-m__form__5737d01C66N{background-color:#fff;border-radius:6px;-webkit-box-shadow:0 2px 15px 0 rgba(210,214,220,.5);box-shadow:0 2px 15px 0 rgba(210,214,220,.5);max-width:700px;overflow:hidden}.SignUp-m__gridcontainer__5737d01Rne0{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));width:100%}.SignUp-m__column__5737d01NIGa{padding:20px}.SignUp-m__info__5737d03AU2H{margin:15px 0;font-size:.7rem}.SignUp-m__input__5737d02oS1c{width:100%;border-radius:4px;color:#000;font-weight:400;background:#fff;font-size:15px;padding:12px;border:1px solid #e3e3e3;-webkit-box-flex:1;-ms-flex:1 0 auto;flex:1 0 auto;line-height:1.4;margin:5px;-webkit-transition:border-color .3s ease-out;transition:border-color .3s ease-out}.SignUp-m__link__5737d03d58p{color:#003866}.SignUp-m__submit__5737d02mNG6{color:#003866;text-decoration:none;background:#fff;padding:10px;border:2px solid #494949;display:inline-block;-webkit-transition:all .4s ease 0s;transition:all .4s ease 0s;cursor:pointer}.SignUp-m__submit__5737d02mNG6:hover{color:#fff;background:#003866;border-color:#003866;-webkit-transition:all .4s ease 0s;transition:all .4s ease 0s}.Layout-m__root__5737d03l2TO{-webkit-box-shadow:rgba(0,0,0,.1) 0 4px 120px;box-shadow:0 4px 120px rgba(0,0,0,.1);grid-column:1/6;padding:0;overflow:hidden}.Layout-m__section__5737d01sUgf{grid-column:2/auto;padding:0 9rem}@media only screen and (max-width:900px){.Layout-m__root__5737d03l2TO{grid-column:1/6;padding:0}.Layout-m__section__5737d01sUgf{grid-column:1/6;padding:0 2rem}}@media only screen and (max-width:480px){.Layout-m__root__5737d03l2TO,.Layout-m__section__5737d01sUgf{grid-column:1/6;padding:0}}code[class*=language-],pre[class*=language-]{color:#f8f8f2;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2b2b2b}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#d4d0ab}.token.punctuation{color:#fefefe}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#ffa07a}.token.boolean,.token.number{color:#00e0e0}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#abe338}.token.entity,.token.operator,.token.url,.token.variable{color:#00e0e0}.token.atrule,.token.attr-value,.token.function{color:gold}.token.keyword{color:#00e0e0}.token.important,.token.regex{color:gold}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}@media screen and (-ms-high-contrast:active){code[class*=language-],pre[class*=language-]{color:windowText;background:window}:not(pre)>code[class*=language-],pre[class*=language-]{background:window}.token.important{background:highlight;color:window;font-weight:400}.token.atrule,.token.attr-value,.token.function,.token.keyword,.token.operator,.token.selector{font-weight:700}.token.attr-value,.token.comment,.token.doctype,.token.function,.token.keyword,.token.operator,.token.property,.token.string{color:highlight}.token.attr-value,.token.url{font-weight:400}}</style></head>
	<body>
		<div id="root"><div class="Layout-m__root__5737d03l2TO"><header class="Header-m__root__5737d015XcQ"><div class="Header-m__title__5737d03OSiY"><a class="Header-m__link__5737d02GEKH" href="/">learn dojo</a></div></header><div class="Hero-m__root__5737d012HF4"><picture><source type="image/webp" srcset="
        /assets/images/learn-dojo-jumbotron-320.webp 320w,
        /assets/images/learn-dojo-jumbotron-640.webp 640w,
        /assets/images/learn-dojo-jumbotron-768.webp 768w,
        /assets/images/learn-dojo-jumbotron-1024.webp 1024w,
        /assets/images/learn-dojo-jumbotron-1366.webp 1366w,
        /assets/images/learn-dojo-jumbotron-1600.webp 1600w,
        /assets/images/learn-dojo-jumbotron-1920.webp 1920w
      "><source type="image/jpeg" srcset="
        /assets/images/learn-dojo-jumbotron-320.jpg 320w,
        /assets/images/learn-dojo-jumbotron-640.jpg 640w,
        /assets/images/learn-dojo-jumbotron-768.jpg 768w,
        /assets/images/learn-dojo-jumbotron-1024.jpg 1024w,
        /assets/images/learn-dojo-jumbotron-1366.jpg 1366w,
        /assets/images/learn-dojo-jumbotron-1600.jpg 1600w,
        /assets/images/learn-dojo-jumbotron-1920.jpg 1920w
      "><img alt="byte by byte" loading="lazy" class="Hero-m__image__5737d02nrHx" src="/assets/images/learn-dojo-jumbotron-768.jpg"></picture><h3 class="Hero-m__description__5737d03I4v5">byte by byte</h3></div><main class="Layout-m__section__5737d01sUgf"><div class="Blog-m__root__5737d01B0aR"><section><picture><source type="image/webp" srcset="/assets/blog/dojo-resources.webp"><source type="image/jpeg" srcset="/assets/blog/dojo-resources.jpg"><img src="/assets/blog/dojo-resources.jpg" alt="Data Aware Widgets in Dojo" loading="lazy"></picture><article class="Article-m__root__5737d01D5nz"><a aria-label="Data Aware Widgets in Dojo" href="dojo-resource-widgets"><h2>Data Aware Widgets in Dojo</h2></a><p>Rene Rubalcava | July 2, 2020</p><div><p>The latest <a href="https://dojo.io/blog/version-7-dojo" target="_blank" rel="nofollow">Dojo release</a> introduced a new way to integrate data into your widgets. Beyond merely managing your application state, you can now create reusable Resource templates that can be used by multiple widgets in the same application. These templates could all interact with the data differently; one could show a list; another could show charts, and so on.</p>
<p>Dojo Resources allow you to build widgets that are <em>data aware</em>. Unlike some robot uprising self-awareness, this one is pretty harmless but very cool. Whereas Dojo Stores are the source of data at the application level, Dojo Resources allow you to narrow the focus to individual widgets. Since we are focusing on making these widgets data-aware, we can do this the Dojo way through a middleware. Resources are not only a state management tool, but also a data fetch tool, so all your data management needs get handled in a single tool.</p>
<p>For this demo, we're going to look at creating a straightforward Hacker News feed.</p>
<h2 id="resource-templates">Resource Templates</h2>
<p>Resources templates describe the various actions of a resource. There are three actions that a resource can have.</p>
<ul>
<li><code>read</code>: How will the resource fetch data, via a web service API, local storage, or another in-memory data source.</li>
<li><code>find</code>: Like the <code>read</code> action, you would use it to find a specific item from the resource.</li>
<li><code>init</code>: Provides a way to initialize the resource with some data.</li>
</ul>
<p>When building this Hacker News feed, there are only a few properties I am interested in for the UI.</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">HackerNewsItem</span> <span class="token punctuation">{</span>
  title<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  url<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  author<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  objectID<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  search<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Let's create a simple template that will read the Hacker News feed.</p>
<pre class="language-ts"><code class="language-ts"><span class="token comment">// template.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  createResourceTemplate<span class="token punctuation">,</span>
  defaultFind
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@dojo/framework/core/middleware/resources"</span><span class="token punctuation">;</span>

<span class="token spread operator">...</span>

<span class="token comment">// Define a template on how to use the resource</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> createResourceTemplate<span class="token operator">&lt;</span><span class="token maybe-class-name">HackerNewsItem</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// Templates require a `find` method. You can use the provided `defaultFind`</span>
  <span class="token comment">// if you don't provide one</span>
  find<span class="token punctuation">:</span> defaultFind<span class="token punctuation">,</span>
  <span class="token comment">// The `read` method gets the request with the payload,</span>
  <span class="token comment">// and ResourceControls to interact with the store</span>
  <span class="token function-variable function">read</span><span class="token punctuation">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> <span class="token punctuation">{</span> put <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>
      size<span class="token punctuation">,</span>
      offset<span class="token punctuation">,</span>
      query<span class="token punctuation">:</span> <span class="token punctuation">{</span> search <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token operator">=</span> request<span class="token punctuation">;</span>
    <span class="token keyword">const</span> page <span class="token operator">=</span> <span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">floor</span><span class="token punctuation">(</span>offset <span class="token operator">/</span> size<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">API_ENDPOINT</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>search<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;page=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>page<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span> data<span class="token punctuation">:</span> result<span class="token punctuation">.</span><span class="token property-access">hits</span><span class="token punctuation">,</span> total<span class="token punctuation">:</span> result<span class="token punctuation">.</span><span class="token property-access">nbHits</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Ok, let's talk a little bit about what is happening in the Resource.</p>
<p>The <code>request</code> is going to provide the payload from the widget. It's going to provide a <code>size</code> and <code>offset</code> that make it easier to paginate your data for reasonably viewing large dataset. It's also going to provide the <code>query</code>, which is on an object that is going to contain any query parameters you are going to use to fetch data.</p>
<p>In this case, we are using a RESTful API for the Hacker News feed, but this could easily get configured for use with GraphQL or in-memory data source.</p>
<h2 id="data-aware-widget">Data-Aware Widget</h2>
<p>Now the fun part! We can create a data-aware widget that can use this Resource. I'll go over the details of this widget, but let's take a look at the whole thing to start.</p>
<pre class="language-tsx"><code class="language-tsx"><span class="token comment">// HackerNewsList.tsx</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> create<span class="token punctuation">,</span> tsx <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@dojo/framework/core/vdom"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createResourceMiddleware <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@dojo/framework/core/middleware/resources"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createICacheMiddleware <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@dojo/framework/core/middleware/icache"</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token maybe-class-name">HackerNewItem</span> <span class="token keyword">from</span> <span class="token string">"./HackerNewItem"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> hnTemplate <span class="token keyword">from</span> <span class="token string">"../hnTemplate"</span><span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name">ListState</span> <span class="token punctuation">{</span>
  search<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  readItemIds<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  page<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Create a resource middleware without a item interface, which means</span>
<span class="token comment">// no resource property will be added to the widget's property API</span>
<span class="token keyword">const</span> resource <span class="token operator">=</span> <span class="token function">createResourceMiddleware</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> icache <span class="token operator">=</span> createICacheMiddleware<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ListState</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">();
const factory = create(</span><span class="token punctuation">{</span> icache<span class="token punctuation">,</span> resource <span class="token punctuation">}</span><span class="token plain-text">);

const HackerNewList = factory(function HackerNewList({
  id,
  middleware: { icache, resource }
}) </span><span class="token punctuation">{</span>
  <span class="token comment">// de-structure resource API controls</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> createOptions<span class="token punctuation">,</span> getOrRead<span class="token punctuation">,</span> isFailed<span class="token punctuation">,</span> isLoading <span class="token punctuation">}</span> <span class="token operator">=</span> resource<span class="token punctuation">;</span>
  <span class="token comment">// create a set of options to work with via the widget id</span>
  <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token function">createOptions</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// get the current search term</span>
  <span class="token keyword">const</span> search <span class="token operator">=</span> icache<span class="token punctuation">.</span><span class="token method function property-access">getOrSet</span><span class="token punctuation">(</span><span class="token string">"search"</span><span class="token punctuation">,</span> <span class="token string">"TypeScript"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> page <span class="token operator">=</span> icache<span class="token punctuation">.</span><span class="token method function property-access">getOrSet</span><span class="token punctuation">(</span><span class="token string">"page"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// resource-aware widgets let you know if they are loading or there was an error</span>
  <span class="token comment">// results return in arrays of pages (can request multiple pages)</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>result<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getOrRead</span><span class="token punctuation">(</span>
    hnTemplate<span class="token punctuation">,</span>
    <span class="token function">options</span><span class="token punctuation">(</span><span class="token punctuation">{</span> size<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span> page<span class="token punctuation">,</span> query<span class="token punctuation">:</span> <span class="token punctuation">{</span> search <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> loading <span class="token operator">=</span> <span class="token function">isLoading</span><span class="token punctuation">(</span>
    hnTemplate<span class="token punctuation">,</span>
    <span class="token function">options</span><span class="token punctuation">(</span><span class="token punctuation">{</span> size<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span> page<span class="token punctuation">,</span> query<span class="token punctuation">:</span> <span class="token punctuation">{</span> search <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> failed <span class="token operator">=</span> <span class="token function">isFailed</span><span class="token punctuation">(</span>
    hnTemplate<span class="token punctuation">,</span>
    <span class="token function">options</span><span class="token punctuation">(</span><span class="token punctuation">{</span> size<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span> page<span class="token punctuation">,</span> query<span class="token punctuation">:</span> <span class="token punctuation">{</span> search <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> readItemIds <span class="token operator">=</span> icache<span class="token punctuation">.</span><span class="token method function property-access">getOrSet</span><span class="token punctuation">(</span><span class="token string">"readItemIds"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>failed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// if a resource read fails, show an error message</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Something went wrong</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">My Hacker Stories</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Search:</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>
          <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span>
          <span class="token attr-name">focus</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token boolean">true</span><span class="token punctuation">}</span></span>
          <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>search<span class="token punctuation">}</span></span>
          <span class="token attr-name">oninput</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> target <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// Dojo 7, icache can now be set without invalidation</span>
            icache<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">"search"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>target <span class="token keyword">as</span> <span class="token maybe-class-name">HTMLInputElement</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
          <span class="token attr-name">onkeydown</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token parameter">event</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token property-access">key</span> <span class="token operator">===</span> <span class="token string">"Enter"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              icache<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">"search"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>current <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> current<span class="token punctuation">)</span><span class="token punctuation">;</span>
              event<span class="token punctuation">.</span><span class="token method function property-access">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
        <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
          <span class="token attr-name">onclick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// Dojo 7, icache can take a function that injects the current state value</span>
            icache<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">"search"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>current <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> current<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
        <span class="token punctuation">&gt;</span></span><span class="token plain-text">
          Submit
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
          <span class="token attr-name">disabled</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">options</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">page</span> <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">}</span></span>
          <span class="token attr-name">onclick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
            icache<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">"page"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">current <span class="token operator">=</span> <span class="token number">1</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> current <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
        <span class="token punctuation">&gt;</span></span><span class="token plain-text">
          prev
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
          <span class="token attr-name">onclick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
            icache<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">"page"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">current <span class="token operator">=</span> <span class="token number">1</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> current <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
        <span class="token punctuation">&gt;</span></span><span class="token plain-text">
          next
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span>loading <span class="token operator">&amp;&amp;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">...loading</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token punctuation">{</span><span class="token operator">!</span>loading <span class="token operator">&amp;&amp;</span>
        result
          <span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=&gt;</span> readItemIds<span class="token punctuation">.</span><span class="token method function property-access">indexOf</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token property-access">objectID</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">(</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">HackerNewItem</span></span>
              <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span><span class="token property-access">objectID</span><span class="token punctuation">}</span></span>
              <span class="token attr-name">item</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span></span>
              <span class="token attr-name">remove</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token parameter">old</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
                icache<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">"readItemIds"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">current <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">[</span><span class="token spread operator">...</span>current<span class="token punctuation">,</span> old<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
            <span class="token punctuation">/&gt;</span></span>
          <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token plain-text">);

export default HackerNewList;
</span></code></pre>
<p>Ok, a lot is going on here, so let's break it down.</p>
<p>First, we need to import the modules to create the widget and use some middleware.</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span> create<span class="token punctuation">,</span> tsx <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@dojo/framework/core/vdom"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createResourceMiddleware <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@dojo/framework/core/middleware/resources"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createICacheMiddleware <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@dojo/framework/core/middleware/icache"</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token maybe-class-name">HackerNewItem</span> <span class="token keyword">from</span> <span class="token string">"./HackerNewItem"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> hnTemplate <span class="token keyword">from</span> <span class="token string">"../hnTemplate"</span><span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name">ListState</span> <span class="token punctuation">{</span>
  search<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  readItemIds<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  page<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The <code>createResourceMiddleware</code> lets you create a typed resource interface to work with resource templates.
The <code>createICacheMiddleware</code> allows you to create a typed <code>icache</code> middleware. It's more type friendly than simply using <code>icache</code> in your widgets. Developer ergonomics people! Someone may have to work on this widget six months down the road and <em>better types, no tears to wipe</em>.</p>
<p>We also import a simple widget to display each news item and our template. <code>ListState</code> is the interface for our widget's local state, making it easier to track what page we are on and which news items we're filtering out.</p>
<p>Now we can create the middleware and our widget factory method.</p>
<pre class="language-tsx"><code class="language-tsx"><span class="token keyword">const</span> resource <span class="token operator">=</span> <span class="token function">createResourceMiddleware</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> icache <span class="token operator">=</span> createICacheMiddleware<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ListState</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">();
const factory = create(</span><span class="token punctuation">{</span> icache<span class="token punctuation">,</span> resource <span class="token punctuation">}</span><span class="token plain-text">);
</span></code></pre>
<p>This approach is pretty straightforward. The factory method will let us create widgets with a local state and resource API. Now we can move on to the widget, which we will cover in sections.</p>
<pre class="language-tsx"><code class="language-tsx"><span class="token keyword">const</span> <span class="token maybe-class-name">HackerNewList</span> <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">HackerNewList</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>
  id<span class="token punctuation">,</span>
  middleware<span class="token punctuation">:</span> <span class="token punctuation">{</span> icache<span class="token punctuation">,</span> resource <span class="token punctuation">}</span>
<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// de-structure resource API controls</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> createOptions<span class="token punctuation">,</span> getOrRead<span class="token punctuation">,</span> isFailed<span class="token punctuation">,</span> isLoading <span class="token punctuation">}</span> <span class="token operator">=</span> resource<span class="token punctuation">;</span>
  <span class="token comment">// create a set of options to work with via the widget id</span>
  <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token function">createOptions</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// get the current search term</span>
  <span class="token keyword">const</span> search <span class="token operator">=</span> icache<span class="token punctuation">.</span><span class="token method function property-access">getOrSet</span><span class="token punctuation">(</span><span class="token string">"search"</span><span class="token punctuation">,</span> <span class="token string">"TypeScript"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> page <span class="token operator">=</span> icache<span class="token punctuation">.</span><span class="token method function property-access">getOrSet</span><span class="token punctuation">(</span><span class="token string">"page"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> currentOptions <span class="token operator">=</span> <span class="token function">options</span><span class="token punctuation">(</span><span class="token punctuation">{</span> size<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span> page<span class="token punctuation">,</span> query<span class="token punctuation">:</span> <span class="token punctuation">{</span> search <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// resource-aware widgets let you know if they are loading or there was an error</span>
  <span class="token comment">// results return in arrays of pages (can request multiple pages)</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>result<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getOrRead</span><span class="token punctuation">(</span>hnTemplate<span class="token punctuation">,</span> currentOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> loading <span class="token operator">=</span> <span class="token function">isLoading</span><span class="token punctuation">(</span>hnTemplate<span class="token punctuation">,</span> currentOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> failed <span class="token operator">=</span> <span class="token function">isFailed</span><span class="token punctuation">(</span>hnTemplate<span class="token punctuation">,</span> currentOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> readItemIds <span class="token operator">=</span> icache<span class="token punctuation">.</span><span class="token method function property-access">getOrSet</span><span class="token punctuation">(</span><span class="token string">"readItemIds"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token spread operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>The <code>resource</code> middleware provides an API to interact with the resource template.</p>
<ul>
<li><code>createOptions</code>: Create a payload specific to your widget via <code>createOptions(id)</code>, where <code>id</code> is the widget's id. This method is useful because you can have multiple widgets using the same resource in your application, so internally Dojo will manage that automatically.</li>
<li><code>getOrRead</code>: Request data from the resource, using the template and the options you provide it. Under the hood, this function is asynchronous, so there are some utility APIs you can use to determine the resource state.</li>
<li><code>isLoading</code>: Given the template and options, it will let you know if the resource if still fetching data.</li>
<li><code>isFailed</code>: Given the template and options, will return <code>true</code> or <code>false</code> if the resource action failed. It's in the name.</li>
</ul>
<p>The rest of this code is getting the current search query, current page, and news item ids that get filtered out.</p>
<p>Let's dig into some widget rendering logic.</p>
<pre class="language-tsx"><code class="language-tsx"><span class="token keyword">const</span> <span class="token maybe-class-name">HackerNewList</span> <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">HackerNewList</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>
  id<span class="token punctuation">,</span>
  middleware<span class="token punctuation">:</span> <span class="token punctuation">{</span> icache<span class="token punctuation">,</span> resource <span class="token punctuation">}</span>
<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token spread operator">...</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>failed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// if a resource read fails, show an error message</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Something went wrong</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">My Hacker Stories</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Search:</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>
          <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span>
          <span class="token attr-name">focus</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token boolean">true</span><span class="token punctuation">}</span></span>
          <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>search<span class="token punctuation">}</span></span>
          <span class="token attr-name">oninput</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> target <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// Dojo 7, icache can now be set without invalidation</span>
            icache<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">"search"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>target <span class="token keyword">as</span> <span class="token maybe-class-name">HTMLInputElement</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
          <span class="token attr-name">onkeydown</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token parameter">event</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token property-access">key</span> <span class="token operator">===</span> <span class="token string">"Enter"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              icache<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">"search"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>current <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> current<span class="token punctuation">)</span><span class="token punctuation">;</span>
              event<span class="token punctuation">.</span><span class="token method function property-access">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
        <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
          <span class="token attr-name">onclick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// Dojo 7, icache can take a function that injects the current state value</span>
            icache<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">"search"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>current <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> current<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
        <span class="token punctuation">&gt;</span></span><span class="token plain-text">
          Submit
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
          <span class="token attr-name">disabled</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">options</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">page</span> <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">}</span></span>
          <span class="token attr-name">onclick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
            icache<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">"page"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">current <span class="token operator">=</span> <span class="token number">1</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> current <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
        <span class="token punctuation">&gt;</span></span><span class="token plain-text">
          prev
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
          <span class="token attr-name">onclick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
            icache<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">"page"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">current <span class="token operator">=</span> <span class="token number">1</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> current <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
        <span class="token punctuation">&gt;</span></span><span class="token plain-text">
          next
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span>loading <span class="token operator">&amp;&amp;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">...loading</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token punctuation">{</span><span class="token operator">!</span>loading <span class="token operator">&amp;&amp;</span>
        result
          <span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=&gt;</span> readItemIds<span class="token punctuation">.</span><span class="token method function property-access">indexOf</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token property-access">objectID</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">(</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">HackerNewItem</span></span>
              <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span><span class="token property-access">objectID</span><span class="token punctuation">}</span></span>
              <span class="token attr-name">item</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span></span>
              <span class="token attr-name">remove</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token parameter">old</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
                icache<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">"readItemIds"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">current <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">[</span><span class="token spread operator">...</span>current<span class="token punctuation">,</span> old<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
            <span class="token punctuation">/&gt;</span></span>
          <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>The first thing we do is check to see if the resource has failed for some reason. The widget doesn't care <em>why</em> it failed, that should get handled by the resource. The widget should only care that something went wrong, so we show a message for that. This convenient approach is a simple way to handle errors in the widget.</p>
<pre class="language-tsx"><code class="language-tsx"><span class="token keyword">if</span> <span class="token punctuation">(</span>failed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// if a resource read fails, show an error message</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Something went wrong</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Once we have verified that our resource has not thrown an error and all is right in our resource world, we can start to look at the substance of our widget.</p>
<pre class="language-tsx"><code class="language-tsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>
  <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span>
  <span class="token attr-name">focus</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token boolean">true</span><span class="token punctuation">}</span></span>
  <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>search<span class="token punctuation">}</span></span>
  <span class="token attr-name">oninput</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> target <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Dojo 7, icache can now be set without invalidation</span>
    icache<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">"search"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>target <span class="token keyword">as</span> <span class="token maybe-class-name">HTMLInputElement</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
  <span class="token attr-name">onkeydown</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token parameter">event</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token property-access">key</span> <span class="token operator">===</span> <span class="token string">"Enter"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      icache<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">"search"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>current <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> current<span class="token punctuation">)</span><span class="token punctuation">;</span>
      event<span class="token punctuation">.</span><span class="token method function property-access">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
  <span class="token attr-name">onclick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Dojo 7, icache can take a function that injects the current state value</span>
    icache<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">"search"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>current <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> current<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="token punctuation">&gt;</span></span><span class="token plain-text">
  Submit
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>The first thing we do is update our local state for the widget. For the <code>oninput</code> event, we don't want our <code>icache</code> update to fire a render, because that will happen when you press the Enter key or the submit button. <code>icache</code> now accepts an optional third boolean argument to update with invalidating local state and preventing the widget from rendering itself.</p>
<pre class="language-ts"><code class="language-ts"><span class="token comment">// This will not force a rerender</span>
icache<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">"search"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>target <span class="token keyword">as</span> <span class="token maybe-class-name">HTMLInputElement</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>During the <code>onkeydown</code> event, we're going to check if the user pressed the Enter key, then we'll kick off all the update goodness of the widget and resource middleware to use the update <code>search</code> of the local state to fetch some new results and update our display.</p>
<pre class="language-ts"><code class="language-ts">icache<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">"search"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>current <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> current<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Instead of passing a value to set the local state, you can pass a function that will inject the current state. In this case, we're not doing anything too useful, but you'll see how this comes into play for pagination.</p>
<p>The next section is going to allow us to paginate through our RESTful API.</p>
<pre class="language-tsx"><code class="language-tsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
  <span class="token attr-name">disabled</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">options</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">page</span> <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">}</span></span>
  <span class="token attr-name">onclick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    icache<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">"page"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">current <span class="token operator">=</span> <span class="token number">1</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> current <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="token punctuation">&gt;</span></span><span class="token plain-text">
  prev
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
  <span class="token attr-name">onclick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    icache<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">"page"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">current <span class="token operator">=</span> <span class="token number">1</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> current <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="token punctuation">&gt;</span></span><span class="token plain-text">
  next
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>The widget tracks the current page of our results in local state. To update the page we are on, we are going to increment or decrement the page. Using the <code>icache</code> with a function to inject local state, this becomes pretty straightforward.</p>
<pre class="language-ts"><code class="language-ts">icache<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">"page"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">current <span class="token operator">=</span> <span class="token number">1</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> current <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
icache<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">"page"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">current <span class="token operator">=</span> <span class="token number">1</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> current <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Modifying local state becomes super simple now that we have access to the current state right in the <code>icache.set()</code> method. You don't need to do this outside the <code>icache</code> and then update it. While this is a small touch, I think it's one that makes development a delight.</p>
<p>Finally, we are going to iterate over the results of our resource and display them.</p>
<pre class="language-tsx"><code class="language-tsx"><span class="token punctuation">{</span>loading <span class="token operator">&amp;&amp;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">...loading</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token operator">!</span>loading <span class="token operator">&amp;&amp;</span>
  result
    <span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=&gt;</span> readItemIds<span class="token punctuation">.</span><span class="token method function property-access">indexOf</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token property-access">objectID</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">HackerNewItem</span></span>
        <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span><span class="token property-access">objectID</span><span class="token punctuation">}</span></span>
        <span class="token attr-name">item</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span></span>
        <span class="token attr-name">remove</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token parameter">old</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
          icache<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">"readItemIds"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">current <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">[</span><span class="token spread operator">...</span>current<span class="token punctuation">,</span> old<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
      <span class="token punctuation">/&gt;</span></span>
    <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
</code></pre>
<p>First, we check if the resource is <code>loading</code>, and display a loading message. If the resource is done loading, we now iterate the results and pass them to a simple widget that displays the news feed item. You might notice that we first filter the results based on a list of <code>readItemIds</code>, which gets updated by a function passed to the <code>HackerNewsItem</code> widget to mark a story as <em>read</em>, and not display it in our feed.</p>
<pre class="language-ts"><code class="language-ts">icache<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">"readItemIds"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">current <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">[</span><span class="token spread operator">...</span>current<span class="token punctuation">,</span> old<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>You can see this full Dojo Hacker News example application on CodeSandbox!</p>
<iframe src="https://codesandbox.io/embed/dojo-hacker-stories-jfhwu" width="100%" height="500" frameborder="0"></iframe>
<h2 id="summary">Summary</h2>
<p>Dojo 7 has some pretty significant updates from previous releases. The introduction of Resources and using them in data-aware widgets is one of my favorites. I could have an entire suite of widgets that can interact with the same resource template and maybe interact and display results differently. I could distribute them as a widget library or web components and start dropping them as needed. I could drop this news feed widget into a sidebar on a blog that shows results related to the topic of the current blog post!</p>
<p>Big thanks to <a href="https://twitter.com/agubler_" target="_blank" rel="nofollow">Anthony Gubler</a>, who helped me navigate the updates to this feature during the Dojo 7 development lifecycle as I was working with the beta and RC releases!</p>
<p>It also may seem like a small thing, but I really appreciate the ability to inject the current state when updating local state like this.</p>
<pre class="language-ts"><code class="language-ts">icache<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">"page"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">current <span class="token operator">=</span> <span class="token number">1</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> current <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
icache<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">"page"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">current <span class="token operator">=</span> <span class="token number">1</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> current <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>That just makes me smile.</p>
<p>Check out the <a href="https://dojo.io/" target="_blank" rel="nofollow">Dojo docs</a> and try out Dojo 7, I think you'll be very pleased!</p></div></article></section></div></main><aside class="SignUp-m__root__5737d01pvR6"><div class="SignUp-m__email__5737d020Zk1"><form class="SignUp-m__form__5737d01C66N" action="https://odoe.us9.list-manage.com/subscribe/post?u=711bff655927baa32886103d5&amp;id=6d978f8bcf" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" target="_blank"><div class="SignUp-m__gridcontainer__5737d01Rne0"><div class="SignUp-m__column__5737d01NIGa"><h3 class="SignUp-m__title__5737d02WSYN"><strong>Subscribe to newsletter</strong></h3><div><label for="mce-EMAIL">Your email</label><input placeholder="Your email" type="email" name="EMAIL" class="SignUp-m__input__5737d02oS1c" id="mce-EMAIL"></div><div><label for="mce-FNAME">Your first name</label><input placeholder="Your first name" type="text" name="FNAME" class="SignUp-m__input__5737d02oS1c" id="mce-FNAME"></div><button class="SignUp-m__submit__5737d02mNG6" type="submit">Subscribe</button><div class="SignUp-m__info__5737d03AU2H"><p>We use Mailchimp as our marketing platform. By clicking below to subscribe, you acknowledge that your information will be transferred to Mailchimp for processing. <a class="SignUp-m__link__5737d03d58p" href="https://mailchimp.com/legal/" rel="noopener noreferrer" target="_blank" aria-label="Learn more about Mailchimp's privacy practices here">Learn more about Mailchimp's privacy practices here.</a></p></div></div></div></form></div></aside><footer class="Footer-m__root__5737d01zPMX"><span> 2020, odoenet</span><br><div><a class="Footer-m__link__5737d03-JoA" href="https://learn-dojo.com/atom.xml" rel="noopener noreferrer" target="_blank" aria-label="rss feed"><picture><source type="image/webp" srcset="/assets/images/logos/rss-logo-32px.webp"><source type="image/jpeg" srcset="/assets/images/logos/rss-logo-32px.png"><img alt="rss feed" loading="lazy" class="Footer-m__logo__5737d02kD38" src="/assets/images/logos/rss-logo-32px.png"></picture></a><a class="Footer-m__link__5737d03-JoA" href="https://github.com/odoe/learn-dojo" rel="noopener noreferrer" target="_blank" aria-label="github"><picture><source type="image/webp" srcset="/assets/images/logos/GitHub-Mark-32px.webp"><source type="image/jpeg" srcset="/assets/images/logos/GitHub-Mark-32px.png"><img alt="github" loading="lazy" class="Footer-m__logo__5737d02kD38" src="/assets/images/logos/GitHub-Mark-32px.png"></picture></a><a class="Footer-m__link__5737d03-JoA" href="https://www.youtube.com/channel/UCTMyJW_31j2hyZGKJpddgaQ" rel="noopener noreferrer" target="_blank" aria-label="youtube"><picture><source type="image/webp" srcset="/assets/images/logos/yt_logo_mono_light_32px.webp"><source type="image/jpeg" srcset="/assets/images/logos/yt_logo_mono_light_32px.png"><img alt="youtube" loading="lazy" class="Footer-m__logo__5737d02kD38" src="/assets/images/logos/yt_logo_mono_light_32px.png"></picture></a><a class="Footer-m__link__5737d03-JoA" href="https://dojo.io/" rel="noopener noreferrer" target="_blank" aria-label="powered by @dojo"><br>powered by @dojo</a></div><br><span class="Footer-m__details__5737d02pZwP">Last build: 8/7/2020</span><br></footer></div></div>
	</body>
</html>
